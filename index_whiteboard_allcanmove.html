<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>AI ç³»ç»Ÿæ¶æ„è®¾è®¡å·¥å…·</title>
</head>

<body>
  <div id="root"></div>

  <!-- React + ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

  <script>
    const { useState, useEffect, useRef } = React;


    const APP_TYPES = [
      "Web Application",
      "Mobile App",
      "Desktop Software",
      "Hybrid App (PWA)",
      "Embedded System",
      "Other"
    ];
    const FEATURES = [
      "User Authentication / Registration",
      "Real-time Communication (chat, video, etc.)",
      "Data Visualization",
      "File Upload / Storage",
      "Online Payments",
      "AI/ML Inference",
      "Social Features (likes, sharing, comments)",
      "API Integration",
      "Offline Support"
    ];
    const USER_COUNTS = [
      "<100",
      "100â€“1,000",
      "1,000â€“10,000",
      "10,000â€“100,000",
      "100,000+"
    ];

    function App() {
      const [prompt, setPrompt] = useState("");
      const [appType, setAppType] = useState(APP_TYPES[0]);
      const [features, setFeatures] = useState([]);
      const [userCount, setUserCount] = useState(USER_COUNTS[0]);
      const [result, setResult] = useState("");
      const [loading, setLoading] = useState(false);
      const [extraNotes, setExtraNotes] = useState([]);
      const [trashNotes, setTrashNotes] = useState([]);

      // â€”â€” æ–°å¢ æ‹–æ‹½ä¿¡æ¯ state â€”â€” 
      const [dragInfo, setDragInfo] = useState({
        id: null, startX: 0, startY: 0, origX: 0, origY: 0
      });

      //æ–°å¢ï¼šå­˜å‚¨ä¸‰å¼ ä¾¿åˆ©è´´ä½ç½®çš„ state
      const [positions, setPositions] = useState({
        "module-1": { x: 33, y: 125 },
        "module-2": { x: 33, y: 245 },
        "module-3": { x: 33, y: 640 }

      });

      // â€”â€” æŒ‰ä¸‹ï¼šè®°å½•èµ·ç‚¹å’ŒåŸå§‹åæ ‡ â€”â€” 
      const handleMouseDown = (e, id) => {
        if (!positions[id]) return;
        e.preventDefault();
        setDragInfo({
          id,
          startX: e.clientX,
          startY: e.clientY,
          origX: positions[id].x,
          origY: positions[id].y
        });
      };

      // â€”â€” æ–°å¢ï¼šåˆ é™¤ä¾¿ç­¾ â€”â€” 
      const handleDelete = id => {
        // 1. æŠŠ extraNotes é‡Œå¯¹åº”é¡¹è¿‡æ»¤æ‰
        setExtraNotes(prev => {
          const deleted = prev.find(n => n.id === id);
          if (deleted) {
            setTrashNotes(trash => [...trash, deleted]); // åŠ å…¥å›æ”¶ç«™
          }
          return prev.filter(n => n.id !== id); // ä» notes ä¸­ç§»é™¤
        });
        // 2. æŠŠ positions é‡Œå¯¹åº”ä½ç½®ä¹Ÿåˆ æ‰
        setPositions(prev => {
          const next = { ...prev };
          delete next[`note-${id}`];
          return next;
        });
      };



      // â€”â€” å…¨å±€ç›‘å¬ ç§»åŠ¨/æ¾å¼€ â€”â€” 
      useEffect(() => {
        if (!dragInfo.id) return;
        const move = e => {
          const dx = e.clientX - dragInfo.startX;
          const dy = e.clientY - dragInfo.startY;
          setPositions(prev => ({
            ...prev,
            [dragInfo.id]: {
              x: dragInfo.origX + dx,
              y: dragInfo.origY + dy
            }
          }));
        };
        const up = () => setDragInfo(info => ({ ...info, id: null }));
        window.addEventListener("mousemove", move);
        window.addEventListener("mouseup", up);
        return () => {
          window.removeEventListener("mousemove", move);
          window.removeEventListener("mouseup", up);
        };
      }, [dragInfo, setPositions]);


      // 2ï¸âƒ£ æ–°å¢ï¼šæ‹–æ‹½å¼€å§‹æ—¶å†™å…¥ id
      const handleDragStart = (e, id) => {
        e.dataTransfer.setData("text/plain", id);
      };

      // 3ï¸âƒ£ æ–°å¢ï¼šæ”¾ç½®å¹¶æ›´æ–°ä½ç½®
      const handleDrop = e => {
        e.preventDefault();
        const id = e.dataTransfer.getData("text/plain");
        if (!positions[id]) return;
        const rect = e.currentTarget.getBoundingClientRect();
        setPositions(prev => ({
          ...prev,
          [id]: {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
          }
        }));
      };

      const handleDragOver = e => {
        e.preventDefault();
      };

      const addNote = () => {
        const newId = Date.now();
        setExtraNotes([...extraNotes, { id: newId, text: "" }]);
        // âœ… æ–°å¢åˆ° positionsï¼Œåæ ‡åŒ module-1 èµ·å§‹
        setPositions(prev => ({
          ...prev,
          [`note-${newId}`]: { x: 100, y: 100 }
        }));
      };


      const toggleFeature = (feat) => {
        setFeatures((prev) =>
          prev.includes(feat)
            ? prev.filter((f) => f !== feat)
            : [...prev, feat]
        );
      };
      //mock ä¸€æ®µæ–¹ä¾¿ä¸è°ƒç”¨APIæŸ¥çœ‹
      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setResult("");

        try {
          // ç”¨ mock æ¨¡æ‹Ÿè¿”å›å†…å®¹
          const mockResponse = {
            result: `ç³»ç»Ÿæ¶æ„å»ºè®®å¦‚ä¸‹ï¼š
        - ä½¿ç”¨ React æ„å»ºå‰ç«¯
        - åç«¯é‡‡ç”¨ Node.js + Express
        - æ•°æ®å­˜å‚¨ä½¿ç”¨ MongoDB
        - é‡‡ç”¨ JWT å®ç°ç”¨æˆ·è®¤è¯`,
          };

          await new Promise((resolve) => setTimeout(resolve, 500)); // æ¨¡æ‹Ÿå»¶è¿Ÿ
          setResult(mockResponse.result);
        } catch (err) {
          setResult("è°ƒç”¨å‡ºé”™ï¼š" + err.message);
        } finally {
          setLoading(false);
        }
      };
      //è°ƒç”¨APIçš„åœ¨è¿™é‡Œ
      /*const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setResult("");
        try {
          const res = await fetch("http://localhost:8000/api/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt, appType, features, userCount })
          });
          const data = await res.json();
          setResult(data.result);
        } catch (err) {
          setResult("è°ƒç”¨å‡ºé”™: " + err.message);
        } finally {
          setLoading(false);
        }
      }; */

      return React.createElement(
        "div",
        {
          style: {
            maxWidth: "1400px",
            margin: "2rem auto",
            fontFamily: "sans-serif",
            padding: "2rem",
            borderRadius: "12px",
            backgroundImage: "url('whiteboard.png')",
            backgroundSize: "cover",
            backgroundRepeat: "no-repeat",
            backgroundPosition: "center",
            boxShadow: "0 0 20px rgba(0, 0, 0, 0.1)",
            position: "relative",
            width: "100%",
            height: "100%",
            minHeight: "100vh",
            overflow: "hidden"
          },

        },
        React.createElement(
          "h1",
          {
            style: {
              position: "absolute",
              top: "0.01rem",
              color: "#333"
            }
          },
          "AI system architecture designer"
        ),

        React.createElement(
          "button",
          {
            onClick: addNote,
            style: {
              margin: "1rem",
              padding: "0.5rem 1rem",
              fontSize: "1rem",
              cursor: "pointer",
              position: "absolute",
              top: "3.5rem"
            },
          },
          "â• æ·»åŠ ä¾¿åˆ©è´´"
        ),

        React.createElement(
          "form",
          {
            onSubmit: handleSubmit,
            //è¿˜æ˜¯æ²¡ç”Ÿæ•ˆï¼Œå¾ˆå¥‡æ€ª
            /*
            onDragOver: (e) => e.preventDefault(),
            onDrop: (e) => {
            e.preventDefault();
            const id = e.dataTransfer.getData("text/plain");
            const el = document.getElementById(id);
            if (el) {
              const containerRect = e.currentTarget.getBoundingClientRect();
              const newX = e.clientX - containerRect.left;
              const newY = e.clientY - containerRect.top;

              el.style.left = `${newX}px`;
              el.style.top = `${newY}px`;
              }
            }*/
          },

          // é€‰æ‹©é¢˜ 1ï¼šåº”ç”¨ç±»å‹
          React.createElement("div", {
            id: "module-1",
            onMouseDown: e => handleMouseDown(e, "module-1"),
            style: {
              background: "#fff78c",  // ç±»ä¼¼ä¾¿åˆ©è´´çš„æ·¡é»„è‰²
              width: "200px",
              padding: "1rem",
              marginBottom: "1rem",
              borderRadius: "0",
              boxShadow: "5px 5px 10px rgba(0, 0, 0, 0.3)",
              position: "absolute",
              left: positions["module-1"].x + "px",
              top: positions["module-1"].y + "px"
            }
          },
            React.createElement("label", { htmlFor: "appType" }, "1. åº”ç”¨ç±»å‹:"),
            React.createElement(
              "select",
              {
                id: "appType",
                value: appType,
                onChange: (e) => setAppType(e.target.value),
                style: { width: "100%", padding: "0.5rem", marginBottom: "1rem" }
              },
              APP_TYPES.map((opt) =>
                React.createElement("option", { key: opt, value: opt }, opt)
              )
            )
          ),
          // é€‰æ‹©é¢˜ 2ï¼šæ ¸å¿ƒåŠŸèƒ½
          React.createElement("div", {
            id: "module-2",
            onMouseDown: e => handleMouseDown(e, "module-2"),
            style: {
              backgroundColor: "#fff78c",       // æ˜äº®ä¾¿åˆ©è´´é»„
              width: "200px",                   // è´´çº¸å°ºå¯¸
              padding: "1rem",
              marginBottom: "1rem",
              borderRadius: "0",                // å°–è§’
              boxShadow: "5px 5px 10px rgba(0, 0, 0, 0.3)", // é˜´å½±å¢å¼ºç«‹ä½“
              position: "absolute",
              left: positions["module-2"].x + "px",
              top: positions["module-2"].y + "px"
            }
          },
            [
              React.createElement("p", null, "2. æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¤šé€‰ï¼‰:"),
              FEATURES.map((feat) =>
                React.createElement(
                  "div",
                  { key: feat },
                  React.createElement(
                    "label",
                    null,
                    React.createElement("input", {
                      type: "checkbox",
                      checked: features.includes(feat),
                      onChange: () => toggleFeature(feat)
                    }),
                    " " + feat
                  )
                )
              )
            ]
          ),
          // é€‰æ‹©é¢˜ 3ï¼šé¢„æœŸç”¨æˆ·é‡
          React.createElement(
            "div", {
            id: "module-3",
            onMouseDown: e => handleMouseDown(e, "module-3"),
            style: {
              backgroundColor: "#fff78c",       // ä¾¿åˆ©è´´é»„
              width: "200px",
              padding: "1rem",
              marginBottom: "1rem",
              borderRadius: "0",
              boxShadow: "5px 5px 10px rgba(0, 0, 0, 0.3)",
              position: "absolute",
              left: positions["module-3"].x + "px",  // æˆ– "module-3"
              top: positions["module-3"].y + "px"
            }
          },
            [
              React.createElement(
                "label",
                {
                  htmlFor: "userCount",
                  style: { marginBottom: "0.5rem", display: "block" }
                },
                "3. é¢„æœŸç”¨æˆ·é‡:"
              ),
              React.createElement(
                "select",
                {
                  id: "userCount",
                  value: userCount,
                  onChange: (e) => setUserCount(e.target.value),
                  style: {
                    width: "100%",
                    padding: "0.5rem",
                    marginTop: "0.5rem"
                  }
                },
                USER_COUNTS.map((opt) =>
                  React.createElement("option", { key: opt, value: opt }, opt)
                )
              )
            ]
          ),
          // é¡¹ç›®æè¿°
          React.createElement("textarea", {
            value: prompt,
            onChange: (e) => setPrompt(e.target.value),
            placeholder: "åœ¨æ­¤è¾“å…¥é¡¹ç›®éœ€æ±‚ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰â€¦",
            rows: 4,
            style: { width: "100%", padding: "0.5rem", marginBottom: "1rem", position: "absolute", bottom: "2.5rem" }
          }),
          React.createElement("button", {
            type: "submit",
            disabled: loading,
            style: { padding: "0.5rem 1rem", position: "absolute", bottom: "0.5rem" }
          }, loading ? "ç”Ÿæˆä¸­â€¦" : "ç”Ÿæˆæ¶æ„æ–¹æ¡ˆ")
        ),
        result &&
        React.createElement("pre", {
          style: { marginTop: "1.5rem", background: "#f5f5f5", padding: "1rem", whiteSpace: "pre-wrap" }
        }, result),

        // æ–°å¢ä¾¿åˆ©è´´
        extraNotes.map((note, index) =>
          React.createElement(
            "div",
            {
              key: note.id,
              id: `note-${note.id}`,
              onMouseDown: e => handleMouseDown(e, `note-${note.id}`),
              style: {
                position: "absolute",
                left: `${positions[`note-${note.id}`].x}px`,
                top: `${positions[`note-${note.id}`].y}px`,
                background: "#fff78c",
                padding: "1rem",
                borderRadius: "0",
                width: "180px",
                boxShadow: "2px 2px 8px rgba(0,0,0,0.15)",
                cursor: "move",
              },
              onDoubleClick: (e) => {
                const editable = e.currentTarget.querySelector(".editable");
                editable.focus();
              },
            },
            React.createElement("div", { /* â€¦åŒä¸Špropsâ€¦ */ },
              // â€”â€” ç¬¬1ä¸ªå­èŠ‚ç‚¹ï¼šåˆ é™¤æŒ‰é’® â€”â€” 
              React.createElement(
                "span",
                {
                  style: {
                    position: "absolute",
                    top: "4px",
                    right: "6px",
                    cursor: "pointer",
                    fontWeight: "bold",
                    fontSize: "16px",
                    lineHeight: "1"
                  },
                  onClick: e => {
                    e.stopPropagation();      // é˜²æ­¢è§¦å‘æ‹–æ‹½
                    handleDelete(note.id);    // è°ƒç”¨æˆ‘ä»¬æ–°å»ºçš„åˆ é™¤å‡½æ•°
                  }
                },
                "Ã—"
              ),
              /* ç„¶åå†æ¸²æŸ“åŸæ¥çš„å¯ç¼–è¾‘å†…å®¹â€¦ */
            ),
            React.createElement("div", {
              className: "editable",
              contentEditable: true,
              suppressContentEditableWarning: true,
              // â‘  ç”¨ dangerouslySetInnerHTML åˆå§‹åŒ–
              dangerouslySetInnerHTML: {
                __html: note.text
                  ? note.text.replace(/\n/g, "<br>")
                  : "<span style='opacity:.6;'>ğŸ“Œ åŒå‡»ç¼–è¾‘ä¾¿åˆ©è´´å†…å®¹</span>"
              },
              onFocus: e => {
                // ç¬¬ä¸€æ¬¡èšç„¦æ—¶æ¸…é™¤ placeholder
                if (!note.text) {
                  e.currentTarget.textContent = "";
                  setExtraNotes(prev =>
                    prev.map(n =>
                      n.id === note.id ? { ...n, text: "" } : n
                    )
                  );
                }
              },
              onInput: (e) => {
                const newText = e.currentTarget.textContent;
                setExtraNotes((prev) =>
                  prev.map((n, i) =>
                    i === index ? { ...n, text: newText } : n
                  )
                );
              },
              style: {
                minHeight: "40px",
                outline: "none",
              },
              //children: note.text || "ğŸ“Œ åŒå‡»ç¼–è¾‘ä¾¿åˆ©è´´å†…å®¹"
            })
          )
        ),

        React.createElement("div", {
          style: {
            position: "fixed", right: "20px", bottom: "20px", background: "#444", color: "white",
            padding: "0.5rem 1rem", borderRadius: "8px", zIndex: 1000, cursor: "pointer"
          },
          onClick: () => alert(trashNotes.map(n => n.text || "(ç©ºå†…å®¹)").join("\n---\n") || "å›æ”¶ç«™ä¸ºç©º")
        }, "ğŸ—‘ï¸ å›æ”¶ç«™ (", trashNotes.length, ")")

      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>

</html>
